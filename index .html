<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>光伏项目AI助手</title>
  <style>
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      padding: 20px; 
      background: #f7f9fc; 
      margin: 0;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      background: white; 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
      overflow: hidden; 
    }
    header {
      background: #1677ff;
      color: white;
      padding: 15px 20px;
      text-align: center;
    }
    .agent-selector {
      padding: 15px;
      background: #f0f2f5;
      text-align: center;
      font-weight: bold;
    }
    .agent-btn {
      padding: 8px 16px;
      margin: 0 10px;
      border: none;
      background: #e6f4ff;
      color: #1677ff;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    .agent-btn.active {
      background: #1677ff;
      color: white;
    }
    .messages { 
      height: 500px; 
      overflow-y: auto; 
      padding: 15px; 
      background: #fafafa; 
      display: flex; 
      flex-direction: column; 
    }
    .msg { 
      padding: 10px 14px; 
      border-radius: 12px; 
      max-width: 70%; 
      line-height: 1.5; 
    }
    .user { 
      background: #e3f2fd; 
      align-self: flex-end; 
      margin-left: auto; 
    }
    .ai { 
      background: #f0f0f0; 
      align-self: flex-start; 
    }
    .message { 
      display: flex; 
      margin-bottom: 12px; 
      flex-direction: column; 
    }
    .sender {
      font-size: 0.8em;
      color: #666;
      margin-bottom: 4px;
    }
    #input-area { 
      display: flex; 
      padding: 15px; 
      border-top: 1px solid #eee; 
      background: white;
    }
    #user-input { 
      flex: 1; 
      padding: 12px; 
      border: 1px solid #ddd; 
      border-radius: 6px; 
      outline: none; 
    }
    #send-btn { 
      margin-left: 10px; 
      padding: 0 20px; 
      background: #1677ff; 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer; 
    }
    .loading {
      color: #999;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>光伏项目AI助手</h1>
    </header>

    <div class="agent-selector">
      <button id="btn1" class="agent-btn active" onclick="selectAgent(1)">浙江省光伏项目政策咨询</button>
      <button id="btn2" class="agent-btn" onclick="selectAgent(2)">EPC合同条款及技术参数解读</button>
    </div>

    <div class="messages" id="messages"></div>

    <div id="input-area">
      <input type="text" id="user-input" placeholder="请输入你的问题..." />
      <button id="send-btn" onclick="send()">发送</button>
    </div>
  </div>

  <script>
    // === Agent 配置 ===
    const AGENTS = [
      null,
      {
        name: "政策咨询助手",
        agentId: "59da3711f932407db87585f563d64ef5",
        apiKey: "sk-6bd1f1028ea940b89d23915734e38892"
      },
      {
        name: "EPC合同助手",
        agentId: "5282a1306fac4bd1817feafec2a828c5",
        apiKey: "sk-594cbe75e2a441099fc49175316d0f0b"
      }
    ];

    let currentAgent = 1;

    function selectAgent(n) {
      currentAgent = n;
      document.getElementById('btn1').classList.toggle('active', n === 1);
      document.getElementById('btn2').classList.toggle('active', n === 2);
      addMessage(`已切换到：${AGENTS[n].name}`, 'ai');
    }

    function send() {
      const input = document.getElementById('user-input');
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, 'user');
      input.value = '';
      callAgent(currentAgent, text);
    }

    function addMessage(text, sender) {
      const messages = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message';

      if (sender === 'ai') {
        const senderDiv = document.createElement('div');
        senderDiv.className = 'sender';
        senderDiv.textContent = 'AI助手';
        messageDiv.appendChild(senderDiv);
      }

      const msg = document.createElement('div');
      msg.className = `msg ${sender}`;
      msg.textContent = text;
      messageDiv.appendChild(msg);

      messages.appendChild(messageDiv);
      messages.scrollTop = messages.scrollHeight;
    }

    async function callAgent(agentNum, prompt) {
      const agent = AGENTS[agentNum];
      const url = 'https://bailian.aliyuncs.com/v1/chat/completions';

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${agent.apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            agent_id: agent.agentId,
            prompt: prompt
          })
        });

        if (!response.ok) {
          const err = await response.text();
          throw new Error(`调用失败: ${response.status} ${err}`);
        }

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content || '未收到有效回复。';
        addMessage(reply, 'ai');
      } catch (error) {
        addMessage('出错了：' + error.message, 'ai');
      }
    }

    // 回车发送
    document.getElementById('user-input').addEventListener('keypress', e => {
      if (e.key === 'Enter') send();
    });

    // 初始化欢迎语
    window.onload = () => {
      addMessage("你好！我是光伏项目AI助手，请选择左侧的助手类型，然后输入你的问题。", 'ai');
    };
  </script>
</body>
</html>